:noaudio:
:scrollbar:
:data-uri:
:toc2:

== Lab 1: Your first WildFly Swarm Project

In this lab, you will examine an existing WildFly Swarm Java project, understand its structure,
and use the WildFly Maven Plugin to run the project. The following labs will introduce you to
OpenShift and containerized microservices.

image:images/swarm_logo_final.png[WildFly Swarm Logo]
image:images/rhoar.png[WildFly Swarm Logo]

.Requirements

* Knowledge of Java language
* Familiarity with Java EE

:numbered:

== Clone the Repository

To get started, use `git` to copy the necessary lab files to your local environment:

    $ cd $HOME
    $ git clone https://github.com/rhoar-enablement/wildfly-swarm

This will create a copy of the lab materials in the `wildfly-swarm` subdirectory.

    $ cd $HOME/wildfly-swarm
    $ ls
    lab1 lab2 lab3 lab4 ...

Each lab is self-contained within each of the subdirectories.

NOTE: You can choose any directory, these instructions use `$HOME` as an example.

== Open `lab1` using the IDE

Each lab in this course is housed in separate directories. Using the command line, find and observe
the files for this lab:

    % cd $HOME/rhoar-enablement/lab1

Included in your lab environment is _Visual Studio Code_, a lightweight IDE for editing projects.
Load the first lab into the IDE:

    $ cd lab1
    $ code .

Once loaded, you should see the lab files and be able to navigate amongst the files. The components
of this first project are laid out in different subdirectories according to Maven best practices:

* `src/main/java` - The source code to the project
* `src/main/resources` - The static resource files referenced in the code
* `lab1-instructions.adoc` - This file
* `pom.xml` - The Maven project file

TIP: WildFly Swarm projects can also be managed using other tools besides Maven, such as Gradle, JBoss Forge, or Swarmtool.
Consult the https://wildfly-swarm.gitbooks.io/wildfly-swarm-users-guide/content/v/2017.7.0/getting-started/tooling/forge-addon.html[docs] for more detail.

== Examine the Project

This project implements a simple RESTful microservice which implements a retail store inventory service.
The major components of the service within the `src/main/java/com/redhat/coolstore` directory are:

* `model/` - The data model for an inventory item, represented as POJOs (Plain old Java Objects)
* `rest/` - The RESTful endpoints using JAX-RS
* `service/` - Handles persistence to and from the database using JPA

Within the `resources/` subdirectory are:

* `project-defaults.yml` - WildFly Swarm configuration file
* `META-INF/*` - JPA-related files defining database structure and initialization

TIP: The `project-defaults.yml` file is a YAML file that externalizes the runtime environment.
For example, you may want to run the same project using a different database (one for testing,
one for production). This file enables you to reconfigure the application without changing its source
code. More information can be found in the https://reference.wildfly-swarm.io/v/2017.7.0/configuration.html[WildFly Swarm documentation].

== Examine the REST endpoint

This project exposes a single RESTful application defined in `RestApplication.java`:

[source, java]
@ApplicationPath("/api")
public class RestApplication extends Application {
}

Then within `InventoryEndpoint.java` a single endpoint is defined:

[source, java]
    @GET
    @Path("/{itemId}")
    @Produces(MediaType.APPLICATION_JSON)
    public Inventory getAvailability(@PathParam("itemId") String itemId) {
        return inventoryService.getInventory(itemId);
    }

Combining these two definitions results in an endpoint that can be accessed via an HTTP GET request.
For example: _GET /api/inventory/329299_ to retrieve the inventory count for a product identified
by _329299_.

== Examine the Maven POM file

The Maven POM file `pom.xml` defines the structure of the project and how to build and run it.
WildFly Swarm projects use a plugin designed for WildFly Swarm, aptly named the https://wildfly-swarm.gitbooks.io/wildfly-swarm-users-guide/content/getting-started/tooling/maven-plugin.html[WildFly Swarm Maven Plugin].
The major components of the POM file include:

* `<project>` - Identifiers and descriptions of the project
* `<properties>` - Maven diretives and project values (such as versions) referenced later in the POM file
* `<dependencyManagement>` - Reusable dependency definitions. Here we bring in WildFly components based on version for use later on
* `<build>` - Directives for building the project. Here we define the use of the WildFly Swarm Maven Plugin.
* `<dependencies>` - Defines the needed components for our WF Swarm app. Here we declare our project needs JAX-RS, JPA, EJB, CDI, and Data Sources functionality.

Later on you will add additional elements to the POM file, but for now this is rather simple.

NOTE: In this lab, we are explicitly declaring the Swarm _Fractions_ necessary for our project in the `<dependencies>` section. WildFly Swarm can
also auto-detect these dependencies, which can be useful for existing Java EE apps you are migrating to WildFly Swarm.

[TIP]
====
In this project, we are referencing the WildFly Swarm Bill of Materials using:

[source, xml]
<groupId>org.wildfly.swarm</groupId>
<artifactId>bom-all</artifactId>
<version>${version.wildfly.swarm}</version>

Using `bom-all` allows us to use any WildFly Swarm fraction, including experimental and deprecated fractions.
Some projects may only wish to reference a subset (for example `bom-stable`) to avoid using experimental or deprecated
fractions. See more information in the https://howto.wildfly-swarm.io/v/2017.7.0/use-a-bom/[docs].
====

== Build and run the project

Let's exercise our first WildFly Swarm project! To build the project, use Maven:

    % mvn clean package

This command will delete any previous builds and re-package the project into a https://wildfly-swarm.gitbooks.io/wildfly-swarm-users-guide/content/getting-started/basics.html[WildFly Swarm Uberjar].
You should get a `BUILD SUCCESS` message (if you do not, your build failed). Once built,
the resulting Uberjar is located in the `target/` directory:

    % ls target/*swarm.jar
    target/inventory-1.0.0-SNAPSHOT-swarm.jar

This file contains our project along with the necessary runtime to execute it.
Let's run the project using plain Java:

    % java -jar target/inventory-1.0.0-SNAPSHOT-swarm.jar

You'll see a lot of output, including the _fractions_ that were loaded and output from the various
fractions as they startup. If successful, you should see:

    2017-07-12 08:37:28,615 INFO  [org.wildfly.swarm] (main) WFSWARM99999: WildFly Swarm is Ready

This is your indication that the project is now running and ready to accept requests.

NOTE: In addition to using `java -jar` to run the project, you can equally use the Maven plugin.
For example, `mvn wildfly-swarm:run`. There are a number of features of the plugin that can be used
with WildFly Swarm to ease the developer burden of remembering complex command lines. See more information
in the https://wildfly-swarm.gitbooks.io/wildfly-swarm-users-guide/content/v/2017.7.0/getting-started/tooling/maven-plugin.html[docs].

== Test the REST endpoint

At this point, you should be able to access the RESTful endpoint. Let's test it out using _curl_:

[source, json]
% curl http://localhost:8080/api/inventory/329299
{"itemId":"329299","location":"Raleigh","quantity":736,"link":"http://maps.google.com/?q=Raleigh"}

The RESTful endpoint returned a JSON object representing the inventory count for this product. Congratulations!

TIP: You can also access this in your browser using the same URL!

== Stop the service

To stop the service, simply press CTRL-C in the terminal window where the service is executing.

CAUTION: Be careful to not leave services running that you are no longer using in this course, as port conflicts may arise later on.



